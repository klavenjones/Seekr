{"ast":null,"code":"import NextAuth from 'next-auth';\nimport Providers from 'next-auth/providers';\nimport { docClient } from '../../../util/docclient';\nexport default NextAuth({\n  // Configure one or more authentication providers\n  providers: [Providers.Auth0({\n    clientId: process.env.NEXT_PUBLIC_AUTH0_CLIENT_ID,\n    clientSecret: process.env.NEXT_PUBLIC_AUTH0_CLIENT_SECRET,\n    domain: process.env.NEXT_PUBLIC_AUTH0_DOMAIN\n  })],\n  session: {\n    jwt: true,\n    maxAge: 1 * 60 * 60\n  },\n  callbacks: {\n    async session(session, user) {\n      session.user.userId = user.sub;\n      return session;\n    },\n\n    async jwt(token, user, account, profile, isNewUser) {\n      console.log('JWT');\n      console.log('USER', user);\n\n      if (user !== null && user !== void 0 && user.id) {\n        token.userId = user.id;\n      }\n\n      console.log('Token', token);\n      return token;\n    },\n\n    async signIn(user, account, profile) {\n      try {\n        let params = {\n          TableName: process.env.NEXT_PUBLIC_DYNAMODB_TABLE,\n          Key: {\n            userId: user.id\n          }\n        };\n        const currentUser = await docClient.get(params).promise();\n\n        if (Object.keys(currentUser).length <= 0) {\n          let newUser = {\n            TableName: process.env.NEXT_PUBLIC_DYNAMODB_TABLE,\n            Item: {\n              userId: user.id,\n              name: profile.name,\n              email: user.email,\n              image: user.image\n            }\n          };\n          await docClient.put(newUser).promise();\n        }\n      } catch (error) {\n        console.log(error.message);\n      }\n\n      return true;\n    }\n\n  }\n});","map":{"version":3,"sources":["/Users/klay/Documents/Seekr/client/pages/api/auth/[...nextauth].js"],"names":["NextAuth","Providers","docClient","providers","Auth0","clientId","process","env","NEXT_PUBLIC_AUTH0_CLIENT_ID","clientSecret","NEXT_PUBLIC_AUTH0_CLIENT_SECRET","domain","NEXT_PUBLIC_AUTH0_DOMAIN","session","jwt","maxAge","callbacks","user","userId","sub","token","account","profile","isNewUser","console","log","id","signIn","params","TableName","NEXT_PUBLIC_DYNAMODB_TABLE","Key","currentUser","get","promise","Object","keys","length","newUser","Item","name","email","image","put","error","message"],"mappings":"AAAA,OAAOA,QAAP,MAAqB,WAArB;AACA,OAAOC,SAAP,MAAsB,qBAAtB;AACA,SAASC,SAAT,QAA0B,yBAA1B;AAEA,eAAeF,QAAQ,CAAC;AACtB;AACAG,EAAAA,SAAS,EAAE,CACTF,SAAS,CAACG,KAAV,CAAgB;AACdC,IAAAA,QAAQ,EAAEC,OAAO,CAACC,GAAR,CAAYC,2BADR;AAEdC,IAAAA,YAAY,EAAEH,OAAO,CAACC,GAAR,CAAYG,+BAFZ;AAGdC,IAAAA,MAAM,EAAEL,OAAO,CAACC,GAAR,CAAYK;AAHN,GAAhB,CADS,CAFW;AAStBC,EAAAA,OAAO,EAAE;AACPC,IAAAA,GAAG,EAAE,IADE;AAEPC,IAAAA,MAAM,EAAE,IAAI,EAAJ,GAAS;AAFV,GATa;AAatBC,EAAAA,SAAS,EAAE;AACT,UAAMH,OAAN,CAAcA,OAAd,EAAuBI,IAAvB,EAA6B;AAC3BJ,MAAAA,OAAO,CAACI,IAAR,CAAaC,MAAb,GAAsBD,IAAI,CAACE,GAA3B;AACA,aAAON,OAAP;AACD,KAJQ;;AAKT,UAAMC,GAAN,CAAUM,KAAV,EAAiBH,IAAjB,EAAuBI,OAAvB,EAAgCC,OAAhC,EAAyCC,SAAzC,EAAoD;AAClDC,MAAAA,OAAO,CAACC,GAAR,CAAY,KAAZ;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ,EAAoBR,IAApB;;AACA,UAAIA,IAAJ,aAAIA,IAAJ,eAAIA,IAAI,CAAES,EAAV,EAAc;AACZN,QAAAA,KAAK,CAACF,MAAN,GAAeD,IAAI,CAACS,EAApB;AACD;;AACDF,MAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAqBL,KAArB;AACA,aAAOA,KAAP;AACD,KAbQ;;AAcT,UAAMO,MAAN,CAAaV,IAAb,EAAmBI,OAAnB,EAA4BC,OAA5B,EAAqC;AACnC,UAAI;AACF,YAAIM,MAAM,GAAG;AACXC,UAAAA,SAAS,EAAEvB,OAAO,CAACC,GAAR,CAAYuB,0BADZ;AAEXC,UAAAA,GAAG,EAAE;AAAEb,YAAAA,MAAM,EAAED,IAAI,CAACS;AAAf;AAFM,SAAb;AAIA,cAAMM,WAAW,GAAG,MAAM9B,SAAS,CAAC+B,GAAV,CAAcL,MAAd,EAAsBM,OAAtB,EAA1B;;AAEA,YAAIC,MAAM,CAACC,IAAP,CAAYJ,WAAZ,EAAyBK,MAAzB,IAAmC,CAAvC,EAA0C;AACxC,cAAIC,OAAO,GAAG;AACZT,YAAAA,SAAS,EAAEvB,OAAO,CAACC,GAAR,CAAYuB,0BADX;AAEZS,YAAAA,IAAI,EAAE;AACJrB,cAAAA,MAAM,EAAED,IAAI,CAACS,EADT;AAEJc,cAAAA,IAAI,EAAElB,OAAO,CAACkB,IAFV;AAGJC,cAAAA,KAAK,EAAExB,IAAI,CAACwB,KAHR;AAIJC,cAAAA,KAAK,EAAEzB,IAAI,CAACyB;AAJR;AAFM,WAAd;AAUA,gBAAMxC,SAAS,CAACyC,GAAV,CAAcL,OAAd,EAAuBJ,OAAvB,EAAN;AACD;AACF,OApBD,CAoBE,OAAOU,KAAP,EAAc;AACdpB,QAAAA,OAAO,CAACC,GAAR,CAAYmB,KAAK,CAACC,OAAlB;AACD;;AAED,aAAO,IAAP;AACD;;AAxCQ;AAbW,CAAD,CAAvB","sourcesContent":["import NextAuth from 'next-auth'\nimport Providers from 'next-auth/providers'\nimport { docClient } from '../../../util/docclient'\n\nexport default NextAuth({\n  // Configure one or more authentication providers\n  providers: [\n    Providers.Auth0({\n      clientId: process.env.NEXT_PUBLIC_AUTH0_CLIENT_ID,\n      clientSecret: process.env.NEXT_PUBLIC_AUTH0_CLIENT_SECRET,\n      domain: process.env.NEXT_PUBLIC_AUTH0_DOMAIN,\n    }),\n  ],\n  session: {\n    jwt: true,\n    maxAge: 1 * 60 * 60,\n  },\n  callbacks: {\n    async session(session, user) {\n      session.user.userId = user.sub\n      return session\n    },\n    async jwt(token, user, account, profile, isNewUser) {\n      console.log('JWT')\n      console.log('USER', user)\n      if (user?.id) {\n        token.userId = user.id\n      }\n      console.log('Token', token)\n      return token\n    },\n    async signIn(user, account, profile) {\n      try {\n        let params = {\n          TableName: process.env.NEXT_PUBLIC_DYNAMODB_TABLE,\n          Key: { userId: user.id },\n        }\n        const currentUser = await docClient.get(params).promise()\n\n        if (Object.keys(currentUser).length <= 0) {\n          let newUser = {\n            TableName: process.env.NEXT_PUBLIC_DYNAMODB_TABLE,\n            Item: {\n              userId: user.id,\n              name: profile.name,\n              email: user.email,\n              image: user.image,\n            },\n          }\n\n          await docClient.put(newUser).promise()\n        }\n      } catch (error) {\n        console.log(error.message)\n      }\n\n      return true\n    },\n  },\n})\n"]},"metadata":{},"sourceType":"module"}